{% extends "layout_body.html" %}

{% block content %}
    {% set weekday_list = ['月', '火', '水', '木', '金', '土', '日', ] %}
    <main role="main">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <h2>{{ event.name }}&nbsp;発表申込</h2>
                    <form action="/event/presentation/register/complete" method="POST" class="needs-validation" novalidate>
                        <input type="hidden" name="event_id" value="{{ event.id }}"/>
                        <input type="hidden" name="coAuthorNum" value="{{ form.get('coAuthorNum') }}"/>

                        <hr class="mb-3">

                        <p class="lead">次のフォームに必要事項をご記入ください．</p>
                        <fieldset class="form-group">
                            <div class="row">
                                <legend class="col-form-label col-sm-3 pt-0">発表種別</legend>
                                <div class="col-sm-9 mb-3 align-self-center">
                                    <div class="custom-control custom-radio">
                                        <input type="radio" id="presentation_type1" name="presentation_type" class="custom-control-input" value="0" checked readonly>
                                        <label class="custom-control-label" for="presentation_type1">口頭発表</label>
                                    </div>
{#                                    <div class="custom-control custom-radio">#}
{#                                        <input type="radio" id="address_type2" name="address_type" class="custom-control-input" value="1" required>#}
{#                                        <label class="custom-control-label" for="address_type2">ポスター発表</label>#}
{#                                    </div>#}
{#                                    <div class="custom-control custom-radio">#}
{#                                        <input type="radio" id="address_type2" name="address_type" class="custom-control-input" value="1" required>#}
{#                                        <label class="custom-control-label" for="address_type2">デモンストレーション</label>#}
{#                                        <div class="invalid-feedback">#}
{#                                            <!-- Valid first name is required. -->#}
{#                                            発表種別を選択してください．#}
{#                                        </div>#}
{#                                    </div>#}
                                </div>
                            </div>
                        </fieldset>

                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label" for="title">タイトル</label>
                            <div class="col-sm-9 mb-3 align-self-center">
                                <input type="text" class="form-control" id="title" name="title" value="{{ form.get('title') }}" readonly>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label" for="abstract">概要
                                <small id="keyword-free-help-block" class="form-text text-muted">400文字以内</small>
                            </label>
                            <div class="col-sm-9 mb-3 align-self-center">
                                <textarea class="form-control" id="abstract" name="abstract" rows="10" maxlength="400" readonly>{{ form.get('abstract') }}</textarea>
                                <p class="text-right"><span id="count" class="badge badge-pill badge-success">400</span></p>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label" for="title">キーワード</label>
                            <div class="col-sm-9 mb-3 align-self-center">
                                <input type="text" class="form-control" id="keyword" name="keyword" value="{{ keyword_list }}" readonly>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label" for="keyword-free">
                                サブキーワード
                            </label>
                            <div class="col-sm-9 mb-3 align-self-center">
                                <input type="text" class="form-control" id="keyword-free" name="keyword-free" placeholder="任意のキーワード" value="{{ form.get('keyword-free') }}" readonly>
                            </div>
                        </div>

                        <hr class="mb-4">

                        <h4>著者情報</h4>

                        <h5 class="mb-3">著者（登壇者）</h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="organization">所属機関</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="organization" name="organization"  value="{{ login_user.user_profile.organization }}" readonly>
                                    <div class="invalid-feedback" style="width: 100%;">
                                        所属機関を入力してください．
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="department">部署名</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="department" name="department"  value="{{ login_user.user_profile.department }}" readonly>
                                    <div class="invalid-feedback" style="width: 100%;">
                                        部署名を入力してください．
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastName">姓</label>
                                <input type="text" class="form-control" id="lastName" name="lastName" value="{{ login_user.user_profile.last_name }}" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="firstName">名</label>
                                <input type="text" class="form-control" id="firstName" name="firstName" value="{{ login_user.user_profile.first_name }}" readonly>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastNameKana">姓（カタカナ）</label>
                                <input type="text" class="form-control" id="lastNameKana" name="lastNameKana" value="{{ login_user.user_profile.last_name_kana }}" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="firstNameKana">名（カタカナ）</label>
                                <input type="text" class="form-control" id="firstNameKana" name="firstNameKana" value="{{ login_user.user_profile.first_name_kana }}" readonly>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastNameKana">姓（英字）</label>
                                <input type="text" class="form-control" id="lastNameRoman" name="lastNameRoman" value="{{ form.get('lastNameRoman') }}" readonly>
                                <div class="invalid-feedback">
                                    姓（英字）を入力してください．
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="firstNameKana">名（英字）</label>
                                <input type="text" class="form-control" id="firstNameRoman" name="firstNameRoman" value="{{ form.get('firstNameRoman') }}" readonly>
                                <div class="invalid-feedback">
                                    名（英字）を入力してください．
                                </div>
                            </div>
                        </div>

                        {% for i in range(form.get('coAuthorNum')|int) %}
                            <hr class="mb-4">

                            <h5 class="mb-3">共同著者 ({{ loop.index }})</h5>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="organization-{{ loop.index }}">組織名（学校名・会社名）</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="organization-{{ loop.index }}" name="organization-{{ loop.index }}" value="{{ form.get('organization-'+loop.index|string) }}" readonly>
                                        <div class="invalid-feedback" style="width: 100%;">
                                            所属を入力してください．
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="department-{{ loop.index }}">部署名</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="department-{{ loop.index }}" name="department-{{ loop.index }}" value="{{ form.get('department-'+loop.index|string) }}" readonly>
                                        <div class="invalid-feedback" style="width: 100%;">
                                            所属を入力してください．
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="lastName-{{ loop.index }}">姓</label>
                                    <input type="text" class="form-control" id="lastName-{{ loop.index }}" name="lastName-{{ loop.index }}" value="{{ form.get('lastName-'+loop.index|string) }}" readonly>
                                    <div class="invalid-feedback">
                                        姓を入力してください．
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="firstName-{{ loop.index }}">名</label>
                                    <input type="text" class="form-control" id="firstName-{{ loop.index }}" name="firstName-{{ loop.index }}" value="{{ form.get('firstName-'+loop.index|string) }}" readonly>
                                    <div class="invalid-feedback">
                                        名を入力してください．
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="lastNameKana-{{ loop.index }}">姓（カタカナ）</label>
                                    <input type="text" class="form-control" id="lastNameKana-{{ loop.index }}" name="lastNameKana-{{ loop.index }}" value="{{ form.get('lastNameKana-'+loop.index|string) }}" readonly>
                                    <div class="invalid-feedback">
                                        セイを入力してください．
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="firstNameKana-{{ loop.index }}">名（カタカナ）</label>
                                    <input type="text" class="form-control" id="firstNameKana-{{ loop.index }}" name="firstNameKana-{{ loop.index }}" value="{{ form.get('firstNameKana-'+loop.index|string) }}" readonly>
                                    <div class="invalid-feedback">
                                        メイを入力してください．
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="lastNameKana-{{ loop.index }}">姓（英字）</label>
                                    <input type="text" class="form-control" id="lastNameRoman-{{ loop.index }}" name="lastNameRoman-{{ loop.index }}" value="{{ form.get('lastNameRoman-'+loop.index|string) }}" readonly>
                                    <div class="invalid-feedback">
                                        姓（英字）を入力してください．
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="firstNameKana-{{ loop.index }}">名（英字）</label>
                                    <input type="text" class="form-control" id="firstNameRoman-{{ loop.index }}" name="firstNameRoman-{{ loop.index }}" value="{{ form.get('firstNameRoman-'+loop.index|string) }}" readonly>
                                    <div class="invalid-feedback">
                                        名（英字）を入力してください．
                                    </div>
                                </div>
                            </div>
                        {% endfor %}

                        <hr class="mb-4">

                        <div class="form-group row">
                            <div class="col-form-label col-sm-3 pt-0">
                                著作権
                                <small class="form-text text-danger">
                                    ※同意できない場合は発表できません．
                                </small>
                            </div>
                            <div class="col-sm-9 mb-3 align-self-center">
                                    <input type="hidden" id="copyright" name="copyright" value="Agree">
                                    <input type="text" class="form-control" value="同意する" readonly>
                                    <small class="form-text text-muted">
                                        全国大会への投稿論文の著作権は，日本情報科教育学会（以下、本学会） に帰属します．ただし，論文の著作者が研究や教育的目的でその論文原稿を使用する場合は、本学会はその使用を許諾します．
                                    </small>
                                    <small class="form-text text-muted">
                                        ※なお，論文を掲載する際の表示氏名は，論文表記のものとさせていただきます．
                                    </small>
                            </div>
                        </div>

                        <hr class="mb-4">

                        <button class="btn btn-info btn-lg btn-block" type="submit">登録する</button>
                    </form>
                </div>
            </div>
        </div>
    </main>

{% endblock %}

{% block js %}
    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
        $(function () {
            // 概要の文字数カウント
            let remain = 400 - $('#abstract').val().length;
            $('#count').text(remain);
            if (remain < 0) {
                $('#count').addClass("badge-danger")
                $('#count').removeClass("badge-success")
            } else {
                $('#count').addClass("badge-success")
                $('#count').removeClass("badge-danger")
            }
        });
    </script>
{% endblock %}